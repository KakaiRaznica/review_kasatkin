<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetroGame Vault</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <h1>RetroGame Vault</h1>

    <div class="filter-container">
        <input type="text" id="filter-search" placeholder="Search by title...">
        <select id="filter-category">
            <option value="">Select Category</option>
        </select>
        <input type="text" id="filter-year" placeholder="Year">
        <select id="filter-rating">
            <option value="">Select Rating Range</option>
            <option value="0-25">0-25</option>
            <option value="25-50">25-50</option>
            <option value="50-60">50-60</option>
            <option value="60-70">60-70</option>
            <option value="70-80">70-80</option>
            <option value="80-100">80-100</option>
        </select>
        <button id="filter-btn">Filter</button>
        <button id="clear-btn">Clear Filters</button>
    </div>

    <div class="games-container" id="games-container">
        <!-- Cards dynamically loaded -->
    </div>

    <div class="pagination">
        <button id="prev-page" disabled>Previous</button>
        <span id="page-info">Page 1</span>
        <button id="next-page">Next</button>
    </div>

    <script>
        let currentPage = 1; // Текущая страница
        const perPage = 20; // Количество игр на странице

        const gamesContainer = document.getElementById('games-container');
        const prevPageButton = document.getElementById('prev-page');
        const nextPageButton = document.getElementById('next-page');
        const pageInfo = document.getElementById('page-info');
        const searchInput = document.getElementById('filter-search');
        const categorySelect = document.getElementById('filter-category');
        const yearInput = document.getElementById('filter-year');
        const ratingSelect = document.getElementById('filter-rating');

        // Загрузка данных с учётом фильтров и пагинации
        function loadGames() {
            const filters = {
                page: currentPage,
                per_page: perPage,
                search: searchInput.value.trim(),
                category: categorySelect.value,
                year: yearInput.value.trim(),
                rating_range: ratingSelect.value
            };

            const query = new URLSearchParams(filters).toString();
            const apiUrl = `/api/games?${query}`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    // Очистка контейнера
                    gamesContainer.innerHTML = '';

                    // Отображение игр
                    data.games.forEach(game => {
                        const card = `
                            <div class="game-card">
                                <img src="${game.image_url || 'default-image.jpg'}" alt="${game.title}" class="game-image">
                                <div class="game-details">
                                    <h3>${game.title}</h3>
                                    <p><strong>Year:</strong> ${game.year}</p>
                                    <p><strong>Category:</strong> ${game.category}</p>
                                    <p><strong>Rating:</strong> ${game.rating}</p>
                                </div>
                            </div>
                        `;
                        gamesContainer.innerHTML += card;
                    });

                    // Обновление информации о странице
                    pageInfo.textContent = `Page ${data.page} of ${data.total_pages}`;

                    // Обновление состояния кнопок
                    prevPageButton.disabled = data.page <= 1;
                    nextPageButton.disabled = data.page >= data.total_pages;
                })
                .catch(err => console.error('Error loading games:', err));
        }

        // Загрузка категорий
        function loadCategories() {
            fetch('/api/categories')
                .then(response => response.json())
                .then(categories => {
                    categorySelect.innerHTML = '<option value="">Select Category</option>'; // Сбрасываем список

                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                })
                .catch(err => console.error('Error loading categories:', err));
        }

        // Обработчики кнопок пагинации
        prevPageButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                loadGames();
            }
        });

        nextPageButton.addEventListener('click', () => {
            currentPage++;
            loadGames();
        });

        // Применение фильтров
        document.getElementById('filter-btn').addEventListener('click', () => {
            currentPage = 1; // Сброс на первую страницу при изменении фильтров
            loadGames();
        });

        // Очистка фильтров
        document.getElementById('clear-btn').addEventListener('click', () => {
            searchInput.value = '';
            categorySelect.value = '';
            yearInput.value = '';
            ratingSelect.value = '';
            currentPage = 1; // Сброс на первую страницу
            loadGames();
        });

        // Загрузка данных при запуске
        loadCategories();
        loadGames();
    </script>
</body>
</html>
